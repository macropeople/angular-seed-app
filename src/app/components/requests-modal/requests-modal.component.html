<clr-modal [clrModalOpen]="opened" (clrModalOpenChange)="modalOpenChange($event)" clrModalSize="xl">
    <h3 class="modal-title">
        Request History
        <p style="margin-top: 0;">App Location: {{sasjsConfig.appLoc}}</p>
    </h3>
    <div style="height: 70vh;" class="modal-body">
        <p *ngIf="!sasjsRequests" class="no-reqs">No requests made</p>
        
        <clr-stack-view *ngIf="sasjsRequests">
            <clr-stack-block *ngFor="let programLog of sasjsRequests">
                <clr-stack-label>{{programLog.serviceLink}}</clr-stack-label>
                <clr-stack-content>{{parseLogTimestamp(programLog.timestamp)}}</clr-stack-content>
                <clr-stack-block class="content">
                    <clr-stack-content>

                        <clr-tabs>
                            <clr-tab>
                                <button clrTabLink>SAS Log</button>
                                <ng-template [(clrIfActive)]="sasLogActive">
                                    <clr-tab-content>
                                        <div class="log-wrapper" [innerHTML]="programLog.logFile"></div>
                                    </clr-tab-content>
                                </ng-template>
                            </clr-tab>
                        
                            <clr-tab>
                                <button clrTabLink>SAS Source Code</button>
                                <ng-template [(clrIfActive)]="sasSourceCodeActive">
                                    <clr-tab-content>
                                        <div class="log-wrapper" [innerHTML]="programLog.sourceCode"></div>
                                    </clr-tab-content>
                                </ng-template>
                            </clr-tab>
                        
                            <clr-tab>
                                <button clrTabLink>SAS Generated Code</button>
                                <ng-template [(clrIfActive)]="sasGeneratedCodeActive">
                                    <clr-tab-content>
                                        <div class="log-wrapper" [innerHTML]="programLog.generatedCode"></div>
                                    </clr-tab-content>
                                </ng-template>
                            </clr-tab>

                            <clr-tab>
                                <clr-dropdown [clrCloseMenuOnItemClick]="true" class="work-tables-dropdown" clrTabLink>
                                    <button clrDropdownTrigger>
                                        SAS Work Tables
                                        <clr-icon shape="caret down"></clr-icon>
                                    </button>
                                    <clr-dropdown-menu *clrIfOpen>
                                        <div *ngFor="let table of programLog.SASWORK | keyvalue" (click)="programLog['selectedTable'] = table.key" [class.selected]="programLog['selectedTable'] === table.key" class="dropdown-item" clrDropdownItem>{{table.key}}</div>
                                    </clr-dropdown-menu>
                                </clr-dropdown>

                                <ng-template [(clrIfActive)]="tablesActive">
                                    <clr-tab-content>
                                        <p *ngIf="programLog['selectedTable']" style="margin-top: 10px;"><strong>{{programLog['selectedTable']}} (first 10 rows) </strong></p>

                                        <div style="min-height: 50vh;">
                                            <table *ngIf="programLog['selectedTable']" style="margin-top: 10px;" class="table">
                                                <thead>
                                                    <tr>
                                                        <th *ngFor="let column of programLog.SASWORK[programLog['selectedTable']].first10rows[0] | keyvalue">{{column.key}}</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr *ngFor="let row of programLog.SASWORK[programLog['selectedTable']].first10rows">
                                                        <td *ngFor="let column of programLog.SASWORK[programLog['selectedTable']].first10rows[0] | keyvalue">{{row[column.key]}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </clr-tab-content>
                                </ng-template>
                            </clr-tab>
                        </clr-tabs>

                    </clr-stack-content>
                </clr-stack-block>
            </clr-stack-block>
        </clr-stack-view>
    </div>
</clr-modal>